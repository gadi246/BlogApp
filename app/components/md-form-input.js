import React from 'react';
import marked from 'marked';
import HTMLPreview from './HTMLPreview';

marked.setOptions({
  // GitHub Flavored Markdown
  gfm: true,
  // GFM tables
  tables: true,
  // GFM line breaks
  breaks: true,
  // Better lists handling
  smartLists: true,
  // Better punctuation handling
  smartypants: true,
  // Code blocks language prefix (reset default)
  langPrefix: '',
  // Prefix for headings ID's
  headerPrefix: 'hid-',
  highlight: false
});

class MDFormInput extends React.Component {
  constructor(props) {
    super(props);
    this.state = ({
      mdValue:'',
      mdPreview:''
    });
    this.onMdChange = this.onMdChange.bind(this);
  }
  componentWillMount(){
    this.setState({
      mdValue: this.props.val || '',
      mdPreview: marked(this.props.val) || ''
    })
  }
  onMdChange(e){
    this.setState({
      mdValue: e.target.value,
      mdPreview: marked(e.target.value)
    })
  }

  render() {
    const {filled } = this.props;
    return(
      <div className="row">
        <div className={`form-group ${filled ? '' : 'has-error'} required col-sm-6`}>
          <label htmlFor="postMd">Markdown</label>
                <textarea className="form-control previewPane"
                          id="postMd"
                          name="postMd"
                          rows={20}
                          placeholder="Post Markdown"
                          value={this.state.mdValue }
                          onChange={this.onMdChange}/>
        </div>
        <div className="col-sm-6">
          <label>HTML Preview (read only)</label>
          {/* Content generated by converting the Markdown to HTML */}
          <div className="form-control previewPane">
            <HTMLPreview>{this.state.mdPreview}</HTMLPreview>
          </div>
        </div>
      </div>
    );
  }
}

export default MDFormInput;
